<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>当前库存查询</title>
    <link rel="stylesheet" type="text/css"
          href="/static/jquery-easyui-1.3.3/themes/default/easyui.css"></link>
    <link rel="stylesheet" type="text/css"
          href="/static/jquery-easyui-1.3.3/themes/icon.css"></link>
    <script type="text/javascript"
            src="/static/jquery-easyui-1.3.3/jquery.min.js"></script>
    <script type="text/javascript"
            src="/static/jquery-easyui-1.3.3/jquery.easyui.min.js"></script>
    <script type="text/javascript"
            src="/static/jquery-easyui-1.3.3/locale/easyui-lang-zh_CN.js"></script>
    <script type="text/javascript" src="/static/js/date.js"></script>
    <script type="text/javascript">
        var json = {};
        //按回车键查询
        $(document).keyup(function (event) {
            if (event.keyCode == 13) {
                screenSale();
            }
        });

        //添加筛选条件
        function addScreen() {
            json = {};
            if ($("#saleNumber").val()) {
                json.saleNumber = $("#saleNumber").val();
            }
            if ($("#location").combobox("getValue")) {
                json.location = $("#location").combobox("getValue");
            }
            if ($("#jitai").combobox("getValue")) {
                json.jitai = $("#jitai").combobox("getValue");
            }
            if ($("#productDate").datebox("getText")) {
                json.productDate = $("#productDate").datebox("getText");
            }
            if ($("#clerk").combobox("getValue")) {
                json.clerk = $("#clerk").combobox("getValue");
            }
            if ($("#group").combobox("getValue")) {
                json.group = $("#group").combobox("getValue");
            }
        }

        //按照条件筛选订单信息
        function screenSale() {
            addScreen();
            refreshData();
        }

        //添加条件筛选时刷新数据
        function refreshData() {
            $.post("/admin/storage/searchLiftMoney", json, function (result) {
                if (result.success) {
                    $("#dg").datagrid('loadData', result.rows);
                }
            }, "json");
        }

        //清空筛选条件,并初始化筛选属性的值
        function clertCondition() {
            loadData();
            json = {};
            $("#saleNumber").val("");
            $("#location").combobox("reset");
            $("#jitai").combobox("reset");
            $("#clerk").combobox("reset");
            $("#group").combobox("reset");
            $("#productDate").datebox("reset");
        }


        function loadData() {
            //加载数据
            $("#dg").datagrid({
                columns: [[{
                    field: 'cb',
                    checkbox: "true",
                    align: "center"
                }, {
                    field: 'id',
                    title: 'id',
                    width: 100,
                    hidden: 'true',
                    align: 'center'
                }, {
                    field: 'saleNumber',
                    title: '订单号',
                    width: 150,
                    align: 'center'
                }, {
                    field: 'dateInProduced',
                    title: '生产日期',
                    width: 100,
                    align: 'center'
                }, {
                    field: 'clerk',
                    title: '员工名称',
                    width: 100,
                    align: 'center',
                    formatter: function (val, row) {
                        if (row.clerk) {
                            return row.clerk.name;
                        }
                        return;
                    }
                }, {
                    field: 'group',
                    title: '班组',
                    width: 100,
                    align: 'center',
                    formatter: function (val, row) {
                        if (row.group) {
                            return row.group.name;
                        }
                        return;
                    }
                }, {
                    field: 'location',
                    title: '仓位',
                    width: 100,
                    align: 'center',
                    formatter: function (val, row) {
                        if (row.location) {
                            return row.location.name;
                        }
                        return;
                    }
                }, {
                    field: 'name',
                    title: '名称',
                    width: 200,
                    align: 'center'
                }, {
                    field: 'jiTai',
                    title: '机台名称',
                    width: 100,
                    align: 'center',
                    formatter: function (val, row) {
                        if (row.jiTai) {
                            return row.jiTai.name;
                        }
                        return;
                    }
                }]],

            });

        }

        //设置仓位
        function setLocation() {
            if ($("#dg").datagrid("getSelections").length < 1) {
                $.messager.alert("系统提示", "<span style='color: red'>请选择要设置仓位和记录！</span>");
                return;
            }
            if (!$("#cang").combobox("getValue")) {
                $.messager.alert("系统提示", "<span style='color: red'>请选择要设置仓位和记录！</span>");
                return;
            }
            var rows = $("#dg").datagrid("getSelections");
            var ids = [];
            for (var i = 0; i < rows.length; i++) {
                ids.push(rows[i].id);
            }
            var idsstr = ids.join(",");
            $.post("/admin/storage/setLocation", {ids: idsstr, location: $("#cang").combobox("getValue")}, function (result) {
                if (result.success) {
                    $("#dg").datagrid("reload");
                }
            });
        }

        $(document).ready(function () {
            loadData();
            $("#clientId").combobox({
                panelHeight: 'auto',
                valueField: 'id',
                textField: 'name',
                url: '/admin/client/clientList',
                onSelect: function (client) {
                    client = client.name;
                    selectClient(client);
                }
            });

            $("#productDate").datebox("setValue", genTodayStr());
        });

    </script>
</head>
<body style="margin: 1px">
<table id="dg" class="easyui-datagrid" fitColumns="false"
       rownumbers="true" url="/admin/storage/outSuccess"
       toolbar="#tb" fit="true">
</table>

<div id="tb" style="padding: 15px;">
    <table>
        <tr>
            <td>&nbsp;&nbsp;&nbsp;&nbsp;订单号： <input id="saleNumber" style="width: 130px"/>
            </td>
            <td>&nbsp;&nbsp;&nbsp;&nbsp;选择仓位： <input
                    class="easyui-combobox" id="location" name="location"
                    style="width: 100px"
                    data-options="panelHeight:'auto',valueField:'id',textField:'name',url:'/admin/location/locationList'"/>
            </td>
            <td>&nbsp;&nbsp;&nbsp;&nbsp;选择机台： <input
                    class="easyui-combobox" id="jitai" name="jitai"
                    style="width: 100px"
                    data-options="panelHeight:'auto',valueField:'id',textField:'name',url:'/admin/jitai/jitaiList'"/>
            </td>

            <td> &nbsp;&nbsp;&nbsp;&nbsp; <a href="javascript:clertCondition()" class="easyui-linkbutton"
                                             iconCls="icon-cancel">清空</a>

            </td>
            <td></td>
            <td rowspan="2">&nbsp;&nbsp;&nbsp;&nbsp;设置仓位： <input
                    class="easyui-combobox" id="cang" name="location"
                    style="width: 100px"
                    data-options="panelHeight:'auto',valueField:'id',textField:'name',url:'/admin/location/locationList'"/>
            </td>
            <td rowspan="2"> &nbsp;&nbsp;&nbsp;&nbsp; <a href="javascript:setLocation()" class="easyui-linkbutton"
                                                         iconCls="icon-ok">确定</a>
            </td>
        </tr>
        <tr>
            <td>&nbsp;&nbsp;&nbsp;&nbsp;日&nbsp;&nbsp;&nbsp;期：&nbsp;&nbsp;<input
                    type="text" id="productDate" name="productDate" class="easyui-datebox"
                    demandd="true" size="15"/></td>
            <td>&nbsp;&nbsp;&nbsp;&nbsp;班&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;组&nbsp;： <input
                    class="easyui-combobox" id="group" name="group"
                    style="width: 100px"
                    data-options="panelHeight:'auto',valueField:'id',textField:'name',url:'/admin/group/groupList'"/>
            </td>
            <td>&nbsp;&nbsp;&nbsp;&nbsp;员工名称： <input
                    class="easyui-combobox" id="clerk" name="clerk"
                    style="width: 100px"
                    data-options="panelHeight:'auto',valueField:'id',textField:'name',url:'/admin/clerk/clerkList'"/>
            </td>
            <td>&nbsp;&nbsp;&nbsp;&nbsp; <a href="javascript:screenSale()"
                                            class="easyui-linkbutton" iconCls="icon-search">查询</a>
                &nbsp;&nbsp;&nbsp;&nbsp; <a href="javascript:printdg()" class="easyui-linkbutton"
                                            iconCls="icon-print" plain="true">打印</a>
            </td>
        </tr>
    </table>
</div>
</body>
</html>