<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>机台生产分配</title>
<link rel="stylesheet" type="text/css"
	href="/static/jquery-easyui-1.3.3/themes/default/easyui.css"></link>
<link rel="stylesheet" type="text/css"
	href="/static/jquery-easyui-1.3.3/themes/icon.css"></link>
<script type="text/javascript"
	src="/static/jquery-easyui-1.3.3/jquery.min.js"></script>
<script type="text/javascript"
	src="/static/jquery-easyui-1.3.3/jquery.easyui.min.js"></script>
<script type="text/javascript"
	src="/static/jquery-easyui-1.3.3/locale/easyui-lang-zh_CN.js"></script>
<script type="text/javascript" src="/static/js/date.js"></script>
<script type="text/javascript">
	//加载数据
	function loadData() {
		//加载数据
		$("#dg").datagrid({
			columns : [ [ {
				field : 'cb',
				checkbox : "true",
				align : "center"
			}, {
				field : "id",
				title : "id号",
				width : "120",
				align : "center",
				hidden : "true"
			}, {
				field : "jiTai",
				title : "生产机台",
				width : "120",
				align : "center",
				formatter : function(value, rows, index) {
					return rows.jiTai.name;
				}
			}, {
				field : "informNumber",
				title : "通知单号",
				width : "100",
				align : "center"
			}, {
				field : "productionMessage",
				title : "产品信息",
				width : "350",
				align : "center"
			}, {
				field : 'taskQuantity',
				title : "任务量",
				width : "200",
				align : "center"
			}, {
				field : "allotState",
				title : "分配状态",
				width : "150",
				align : "center"
			}, {
				field : "issueState",
				title : "下发状态",
				width : "100",
				align : "center"
			} ] ]
		});
	}

	//清空条件并重新加载数据
	function reset() {
		$("#allorTime").datebox("reset");
		$("#jitai").combobox("reset");
		$("#dg").datagrid("reload");
	}

	//根据条件对数据进行筛选
	function screen() {
		console.log("screen");
		var json = {};
		if ($("#jitai").combobox("getValue")) {
			json.jitai = $("#jitai").combobox("getValue");
		}
		if ($("#allorTime").datebox("getValue")) {
			json.allorTime = $("#allorTime").datebox("getValue");
		}
		$.post("/admin/jitaiProductionAllot/screen", json, function(result) {
			if(result.success) {
				console.log(result);
				console.log(result.rows);
				$("#dg").datagrid('loadData', result.rows);
			}
		});
		console.log(json);
	}

	$(document).ready(function() {
		//当选择一个日期的时候执行的操作
		$("#allorTime").datebox({
			onSelect : function(date) {
				screen();
			}
		});

		//当选择一个机台的时候执行
		$("#jitai").combobox({
			onSelect : function(date) {
				screen();
			}
		});
		loadData();
	});
</script>
</head>
<body style="margin: 1px">
	<table id="dg" title="商标设置" class="easyui-datagrid" fitColumns="false"
		rownumbers="true" url="/admin/jitaiProductionAllot/list" toolbar="#tb"
		fit="true">
	</table>

	<div id="tb" style="padding: 15px;">
		<table>
			<tr>
				<td>&nbsp;&nbsp;&nbsp;&nbsp;日期： <input class="easyui-datebox"
					id="allorTime" style="width: 100px" /></td>
				<td>&nbsp;&nbsp;&nbsp;&nbsp;机台： <input id="jitai"
					class="easyui-combobox" url="/admin/jitai/findAll" name="mode"
					valueField="id" panelHeight="auto" textField="name"
					style="width: 98px" />
				</td>
				<td>&nbsp;&nbsp;&nbsp;&nbsp;<a class="easyui-linkbutton"
					iconCls="icon-cancel" href="javascript:reset()">清空</a>
				</td>
				<td>&nbsp;&nbsp;&nbsp;&nbsp;<a class="easyui-linkbutton"
					iconCls="icon-add" href="javascript:reset()">下发</a>
				</td>
			</tr>
		</table>
	</div>
</body>
</html>